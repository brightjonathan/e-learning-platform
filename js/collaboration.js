function loadCollaboration(){protectRoute(["student","supervisor","admin"]);const d=JSON.parse(localStorage.getItem("document")||"{}");document.getElementById("doc-content").value=d.content||"",loadChat()}function saveDoc(){const c=document.getElementById("doc-content").value,t=new Date().toLocaleString();localStorage.setItem("document",JSON.stringify({content:c,time:t})),addActivity("Saved document draft"),alert("Draft saved!")}function sendMessage(){const i=document.getElementById("chat-input");if(!i.value)return;const u=JSON.parse(localStorage.getItem("currentUser")),m=JSON.parse(localStorage.getItem("chat")||"[]");m.push({user:u.username,message:i.value,time:new Date().toLocaleTimeString()}),localStorage.setItem("chat",JSON.stringify(m)),i.value="",loadChat()}function loadChat(){const m=JSON.parse(localStorage.getItem("chat")||"[]"),c=document.getElementById("chat-box");c.innerHTML="",m.forEach(e=>{const t=document.createElement("p");t.innerHTML=`<strong>${e.user}:</strong> ${e.message} <small>${e.time}</small>`,c.appendChild(t)})}function addActivity(e){const u=JSON.parse(localStorage.getItem("currentUser")),a=JSON.parse(localStorage.getItem("activities")||"[]");a.push({user:u.email,message:e,time:new Date().toLocaleString()}),localStorage.setItem("activities",JSON.stringify(a))}